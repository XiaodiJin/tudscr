%\RequirePackage[ngerman=ngerman-x-latest]{hyphsubst}
% \documentclass[english,ngerman,BCOR=6mm,parskip=false]{tudscrreprt}
% \setlength{\parskip}{0.7ex}
\documentclass[english,ngerman,BCOR=6mm,cdgeometry=no,DIV=13,cdfont=no]{tudscrreprt}
%\usepackage{selinput}\SelectInputMappings{adieresis={ä},germandbls={ß}}
%\usepackage[T1]{fontenc}
\usepackage{babel}

\usepackage{showframe}

\newcommand*{\ind}[1]{\ensuremath{_\mathrm{#1}}}
\newcommand{\fref}[1]{Abbildung\ \ref{#1}}
\usepackage[colorlinks=true,linkcolor=blue,urlcolor=blue,citecolor=red]{hyperref}

%%%%%%%%%% Das ist neu!
\usepackage{filemod}
\usepackage{kvsetkeys}
\usepackage{graphicx}
\usepackage{svg}
%\DeclareUnicodeCharacter{2212}{\hskip-.3em\ensuremath{-}}
\makeatletter
\providecommand*\SVG@in@path{./}
\newcommand*\svgpath[1]{\def\SVG@in@path{#1}}
\newcommand*\SVG@get@@path{}
\newcommand*\SVG@get@path[1]{%
  \def\SVG@get@@path##1#1.svg##2\@nil{\edef\SVG@in@path{##1}}%
  \IfFileExists{#1.svg}{\expandafter\SVG@get@@path\@filef@und\@nil}{}%
}
\graphicspath{{./bla/}{blubb/}}
\svgpath{{./bla/}{./test/}}
\newcommand*{\newincludesvg}[2][\textwidth]{%
% TODO: in tudscr übernehmen oder svg erweitern?
%  \pdfsuppresswarningpagegroup=1%
  \begingroup%
    \let\@tempa\SVG@in@path%
    \SVG@get@path{#2}%
    \ifx\@tempa\SVG@in@path%
      \def\@tempa{./}%
      \ifx\@tempa\SVG@in@path\else%
        \let\@tempa\SVG@in@path%
        \let\input@path\SVG@in@path%
        \SVG@get@path{#2}%
      \fi%
      \ifx\@tempa\SVG@in@path%
        \ifx\Ginput@path\@undefined\else%
          \let\input@path\Ginput@path%
          \SVG@get@path{#2}%
        \fi%
      \fi%
    \fi%
    \edef\@tempa{\pdffilemoddate{\SVG@in@path#2.svg}}
    \edef\@tempb{\pdffilemoddate{\SVG@in@path#2.pdf}}
    \@tempswafalse%
    \ifnum\pdfstrcmp{\@tempa}{\@tempb}>\z@\relax\@tempswatrue\fi%
    \IfFileExists{\SVG@in@path#2.pdf_tex}{}{\@tempswatrue}%
    \if@tempswa%
        % TODO: key für options
      \immediate\write18{%
        inkscape -z -D 
        --file=\SVG@in@path#2.svg
        --export-pdf=\SVG@in@path#2.pdf
        --export-latex%
      }%
    \fi%
    \IfFileExists{\SVG@in@path#2.svg}{%
      \IfFileExists{\SVG@in@path#2.pdf}{%
        \def\svgwidth{#1}%
        \pdfximage{\SVG@in@path#2.pdf}%
        \let\saved@includegraphics\includegraphics%
        \let\includegraphics\patch@includegraphics%
        \InputIfFileExists{\SVG@in@path#2.pdf_tex}{}{%
          \PackageWarning{svg}{%
            Something went wrong during the inkscape file\MessageBreak%
            export. File \SVG@in@path#2.pdf_tex does not exist%
          }%
        }%
      }{%
        \PackageWarning{svg}{%
          The latex export of file \SVG@in@path#2.svg wasn't\MessageBreak%
          successful, the necessary file \SVG@in@path#2.pdf is\MessageBreak%
          missing. You should enable `shell escape' (or `write18')\MessageBreak%
          or export \SVG@in@path#2.pdf manually with inkscape\MessageBreak%
        }%
      }%
    }{%
      \PackageError{svg}{File #2.svg doesn't exist}{%
        There is no file #2.svg neither in the current\MessageBreak%
        directory nor any other searched path given by\MessageBreak%
        \string\svgpath%
        \ifx\Ginput@path\@undefined\else%
          \space or \string\graphicspath.%
        \fi%
      }%
    }%
  \endgroup%
}
\newcommand*\saved@includegraphics{}
\newcommand*\patch@includegraphics[2][]{%
  \define@key{svg}{page}{\@tempcnta=##1\relax}%
  \kv@set@family@handler{svg}{}%
  \kvsetkeys{svg}{#1}%
  \ifnum\@tempcnta>\pdflastximagepages\relax\else%
    \saved@includegraphics[#1]{#2}%
  \fi%
}
\makeatother
%%%%%%%%%%%%%%%%%%%% ENDE

%-------------------------------------------------------------------------------------------------
\begin{document}
\section{Beispiel}\label{sec:Beispiel}
\fref{Bild} ist richtig gudd. Könntest natürlich auch sinnvollerweise den 
Befehl \texttt{\string\autoref} aus dem Paket \texttt{hyperref} nehmen: 
\autoref{Bild}. Damit geht auch das hier: \autoref{sec:Beispiel} :p


%\begin{figure}
%  \centering \def\svgwidth{\linewidth} 
%  \input{Abbildung_Latex.pdf_tex} 
%  \caption{Geht ni!}
%  \label{Bild}
%\end{figure}

%\setsvg{svgpath={{./test/}}}

\makeatletter
%\meaning\SVG@in@path
\makeatother

%\begin{figure}
%  \centering
%  \includesvg[svgpath=bla/,width=.2\textwidth]{Abbildung}
%  \includesvg[width=.4\textwidth]{Bild}\par  
  \newincludesvg[.2\textwidth]{Bild}
  
  \newincludesvg[.2\textwidth]{Abbildung}
  
  \newincludesvg[.2\textwidth]{Test}
%  \captionof{figure}{Geht wohl!}
  \label{Bild}
%\end{figure}
\clearpage
\end{document}